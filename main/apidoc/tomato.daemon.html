<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tomato.daemon package &mdash; tomato 2.1rc2.post1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/autodoc_pydantic.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom_theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/tomato_ico.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=78520348"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="tomato.driverinterface_1_0 package" href="tomato.driverinterface_1_0.html" />
    <link rel="prev" title="tomato package" href="tomato.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            tomato
              <img src="../_static/tomato.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.1rc2.post1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">tomato user manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick start guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver_develop.html">Developing <strong>tomato</strong> drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../version.html">Version history</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">tomato driver library</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/dgbowl/tomato-example-counter">tomato-example-counter</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/dgbowl/tomato-psutil">tomato-psutil</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/dgbowl/tomato-bronkhorst/">tomato-bronkhorst</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/dgbowl/tomato-jumo">tomato-jumo</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">tomato autodocs</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="tomato.html">tomato package</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tomato.html#tomato.set_loglevel"><code class="docutils literal notranslate"><span class="pre">set_loglevel()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tomato.html#tomato.parse_args"><code class="docutils literal notranslate"><span class="pre">parse_args()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tomato.html#tomato.run_tomato"><code class="docutils literal notranslate"><span class="pre">run_tomato()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tomato.html#tomato.run_ketchup"><code class="docutils literal notranslate"><span class="pre">run_ketchup()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="tomato.html#tomato.run_passata"><code class="docutils literal notranslate"><span class="pre">run_passata()</span></code></a></li>
<li class="toctree-l2 current"><a class="reference internal" href="tomato.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">tomato.daemon package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tomato-daemon-module-of-functions-comprising-the-tomato-daemon"><strong>tomato.daemon</strong>: module of functions comprising the tomato daemon</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tomato.daemon.setup_logging"><code class="docutils literal notranslate"><span class="pre">setup_logging()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#tomato.daemon.tomato_daemon"><code class="docutils literal notranslate"><span class="pre">tomato_daemon()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-tomato.daemon.cmd">Submodules</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#tomato-daemon-cmd-command-parsing-for-tomato-daemon"><strong>tomato.daemon.cmd</strong>: command parsing for tomato daemon</a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.cmd.merge_pipelines"><code class="docutils literal notranslate"><span class="pre">merge_pipelines()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.cmd.status"><code class="docutils literal notranslate"><span class="pre">status()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.cmd.stop"><code class="docutils literal notranslate"><span class="pre">stop()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.cmd.setup"><code class="docutils literal notranslate"><span class="pre">setup()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.cmd.pipeline"><code class="docutils literal notranslate"><span class="pre">pipeline()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.cmd.set_job"><code class="docutils literal notranslate"><span class="pre">set_job()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.cmd.get_jobs"><code class="docutils literal notranslate"><span class="pre">get_jobs()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.cmd.driver"><code class="docutils literal notranslate"><span class="pre">driver()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.cmd.device"><code class="docutils literal notranslate"><span class="pre">device()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.cmd.component"><code class="docutils literal notranslate"><span class="pre">component()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato-daemon-driver-the-driver-manager-of-tomato-daemon"><strong>tomato.daemon.driver</strong>: the driver manager of tomato daemon</a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.driver.tomato_driver_bootstrap"><code class="docutils literal notranslate"><span class="pre">tomato_driver_bootstrap()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.driver.perform_idle_measurements"><code class="docutils literal notranslate"><span class="pre">perform_idle_measurements()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.driver.tomato_driver"><code class="docutils literal notranslate"><span class="pre">tomato_driver()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.driver.spawn_tomato_driver"><code class="docutils literal notranslate"><span class="pre">spawn_tomato_driver()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.driver.stop_tomato_driver"><code class="docutils literal notranslate"><span class="pre">stop_tomato_driver()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.driver.manager"><code class="docutils literal notranslate"><span class="pre">manager()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato-daemon-io-functions-for-storing-and-loading-data"><strong>tomato.daemon.io</strong>: functions for storing and loading data</a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.io.store"><code class="docutils literal notranslate"><span class="pre">store()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.io.load"><code class="docutils literal notranslate"><span class="pre">load()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.io.merge_netcdfs"><code class="docutils literal notranslate"><span class="pre">merge_netcdfs()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.io.data_to_pickle"><code class="docutils literal notranslate"><span class="pre">data_to_pickle()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato-daemon-job-the-job-manager-of-tomato-daemon"><strong>tomato.daemon.job</strong>: the job manager of tomato daemon</a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.job.method_validate"><code class="docutils literal notranslate"><span class="pre">method_validate()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.job.find_matching_pipelines"><code class="docutils literal notranslate"><span class="pre">find_matching_pipelines()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.job.kill_tomato_job"><code class="docutils literal notranslate"><span class="pre">kill_tomato_job()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.job.manage_running_pips"><code class="docutils literal notranslate"><span class="pre">manage_running_pips()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.job.check_queued_jobs"><code class="docutils literal notranslate"><span class="pre">check_queued_jobs()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.job.action_queued_jobs"><code class="docutils literal notranslate"><span class="pre">action_queued_jobs()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.job.manager"><code class="docutils literal notranslate"><span class="pre">manager()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.job.tomato_job"><code class="docutils literal notranslate"><span class="pre">tomato_job()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.job.job_thread"><code class="docutils literal notranslate"><span class="pre">job_thread()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.job.job_main_loop"><code class="docutils literal notranslate"><span class="pre">job_main_loop()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato-daemon-jobdb-the-sqlite-database-for-jobs-in-tomato"><strong>tomato.daemon.jobdb</strong>: the sqlite database for jobs in tomato</a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.jobdb.connect_jobdb"><code class="docutils literal notranslate"><span class="pre">connect_jobdb()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.jobdb.jobdb_setup"><code class="docutils literal notranslate"><span class="pre">jobdb_setup()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.jobdb.insert_job"><code class="docutils literal notranslate"><span class="pre">insert_job()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.jobdb.update_job_id"><code class="docutils literal notranslate"><span class="pre">update_job_id()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.jobdb.get_job_id"><code class="docutils literal notranslate"><span class="pre">get_job_id()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#tomato.daemon.jobdb.get_jobs_where"><code class="docutils literal notranslate"><span class="pre">get_jobs_where()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tomato.driverinterface_1_0.html">tomato.driverinterface_1_0 package</a></li>
<li class="toctree-l3"><a class="reference internal" href="tomato.driverinterface_2_0.html">tomato.driverinterface_2_0 package</a></li>
<li class="toctree-l3"><a class="reference internal" href="tomato.driverinterface_2_1.html">tomato.driverinterface_2_1 package</a></li>
<li class="toctree-l3"><a class="reference internal" href="tomato.ketchup.html">tomato.ketchup package</a></li>
<li class="toctree-l3"><a class="reference internal" href="tomato.passata.html">tomato.passata package</a></li>
<li class="toctree-l3"><a class="reference internal" href="tomato.tomato.html">tomato.tomato package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tomato.html#module-tomato.drivers">Submodules</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">tomato</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="tomato.html">tomato package</a></li>
      <li class="breadcrumb-item active">tomato.daemon package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/apidoc/tomato.daemon.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-tomato.daemon">
<span id="tomato-daemon-package"></span><h1>tomato.daemon package<a class="headerlink" href="#module-tomato.daemon" title="Link to this heading"></a></h1>
<section id="tomato-daemon-module-of-functions-comprising-the-tomato-daemon">
<h2><strong>tomato.daemon</strong>: module of functions comprising the tomato daemon<a class="headerlink" href="#tomato-daemon-module-of-functions-comprising-the-tomato-daemon" title="Link to this heading"></a></h2>
<p><em>Code author: Peter Kraus</em></p>
</section>
<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.setup_logging">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.</span></span><span class="sig-name descname"><span class="pre">setup_logging</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daemon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tomato.html#tomato.models.Daemon" title="tomato.models.Daemon"><span class="pre">Daemon</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tomato.daemon.setup_logging" title="Link to this definition"></a></dt>
<dd><p>Helper function to set up logging (folder, filename, verbosity, format) based on
the passed daemon state.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.tomato_daemon">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.</span></span><span class="sig-name descname"><span class="pre">tomato_daemon</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tomato.daemon.tomato_daemon" title="Link to this definition"></a></dt>
<dd><p>The function called when <cite>tomato-daemon</cite> is executed.</p>
<p>Manages the state of the tomato daemon, including recovery of state via
<a class="reference internal" href="#module-tomato.daemon.io" title="tomato.daemon.io"><code class="xref py py-mod docutils literal notranslate"><span class="pre">io</span></code></a>, processing state updates via <a class="reference internal" href="#module-tomato.daemon.cmd" title="tomato.daemon.cmd"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cmd</span></code></a>,
and the manager threads for both jobs (<a class="reference internal" href="#module-tomato.daemon.job" title="tomato.daemon.job"><code class="xref py py-mod docutils literal notranslate"><span class="pre">job</span></code></a>) and drivers
(<a class="reference internal" href="#module-tomato.daemon.driver" title="tomato.daemon.driver"><code class="xref py py-mod docutils literal notranslate"><span class="pre">driver</span></code></a>).</p>
</dd></dl>

<section id="module-tomato.daemon.cmd">
<span id="submodules"></span><h2>Submodules<a class="headerlink" href="#module-tomato.daemon.cmd" title="Link to this heading"></a></h2>
<section id="tomato-daemon-cmd-command-parsing-for-tomato-daemon">
<h3><strong>tomato.daemon.cmd</strong>: command parsing for tomato daemon<a class="headerlink" href="#tomato-daemon-cmd-command-parsing-for-tomato-daemon" title="Link to this heading"></a></h3>
<p><em>Code author: Peter Kraus</em></p>
<p>All functions in this module expect a <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code> containing the command specification
and a <a class="reference internal" href="tomato.html#tomato.models.Daemon" title="tomato.models.Daemon"><code class="xref py py-class docutils literal notranslate"><span class="pre">Daemon</span></code></a> object as arguments. The <code class="xref py py-class docutils literal notranslate"><span class="pre">Daemon</span></code> object is
altered by the command.</p>
<p>All functions in this module return a <a class="reference internal" href="tomato.html#tomato.models.Reply" title="tomato.models.Reply"><code class="xref py py-class docutils literal notranslate"><span class="pre">Reply</span></code></a>.</p>
</section>
<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.cmd.merge_pipelines">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.cmd.</span></span><span class="sig-name descname"><span class="pre">merge_pipelines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cur</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="tomato.html#tomato.models.Pipeline" title="tomato.models.Pipeline"><span class="pre">Pipeline</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="tomato.html#tomato.models.Pipeline" title="tomato.models.Pipeline"><span class="pre">Pipeline</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="tomato.html#tomato.models.Pipeline" title="tomato.models.Pipeline"><span class="pre">Pipeline</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#tomato.daemon.cmd.merge_pipelines" title="Link to this definition"></a></dt>
<dd><p>Helper function for merging a <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code> of new <code class="xref py py-class docutils literal notranslate"><span class="pre">Pipelines</span></code> into the
current <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.cmd.status">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.cmd.</span></span><span class="sig-name descname"><span class="pre">status</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">daemon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tomato.html#tomato.models.Daemon" title="tomato.models.Daemon"><span class="pre">Daemon</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="tomato.html#tomato.models.Reply" title="tomato.models.Reply"><span class="pre">Reply</span></a></span></span><a class="headerlink" href="#tomato.daemon.cmd.status" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.cmd.stop">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.cmd.</span></span><span class="sig-name descname"><span class="pre">stop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">daemon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tomato.html#tomato.models.Daemon" title="tomato.models.Daemon"><span class="pre">Daemon</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="tomato.html#tomato.models.Reply" title="tomato.models.Reply"><span class="pre">Reply</span></a></span></span><a class="headerlink" href="#tomato.daemon.cmd.stop" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.cmd.setup">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.cmd.</span></span><span class="sig-name descname"><span class="pre">setup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">daemon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tomato.html#tomato.models.Daemon" title="tomato.models.Daemon"><span class="pre">Daemon</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="tomato.html#tomato.models.Reply" title="tomato.models.Reply"><span class="pre">Reply</span></a></span></span><a class="headerlink" href="#tomato.daemon.cmd.setup" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.cmd.pipeline">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.cmd.</span></span><span class="sig-name descname"><span class="pre">pipeline</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">daemon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tomato.html#tomato.models.Daemon" title="tomato.models.Daemon"><span class="pre">Daemon</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="tomato.html#tomato.models.Reply" title="tomato.models.Reply"><span class="pre">Reply</span></a></span></span><a class="headerlink" href="#tomato.daemon.cmd.pipeline" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.cmd.set_job">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.cmd.</span></span><span class="sig-name descname"><span class="pre">set_job</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">daemon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tomato.html#tomato.models.Daemon" title="tomato.models.Daemon"><span class="pre">Daemon</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="tomato.html#tomato.models.Reply" title="tomato.models.Reply"><span class="pre">Reply</span></a></span></span><a class="headerlink" href="#tomato.daemon.cmd.set_job" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.cmd.get_jobs">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.cmd.</span></span><span class="sig-name descname"><span class="pre">get_jobs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">daemon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tomato.html#tomato.models.Daemon" title="tomato.models.Daemon"><span class="pre">Daemon</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="tomato.html#tomato.models.Reply" title="tomato.models.Reply"><span class="pre">Reply</span></a></span></span><a class="headerlink" href="#tomato.daemon.cmd.get_jobs" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.cmd.driver">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.cmd.</span></span><span class="sig-name descname"><span class="pre">driver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">daemon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tomato.html#tomato.models.Daemon" title="tomato.models.Daemon"><span class="pre">Daemon</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="tomato.html#tomato.models.Reply" title="tomato.models.Reply"><span class="pre">Reply</span></a></span></span><a class="headerlink" href="#tomato.daemon.cmd.driver" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.cmd.device">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.cmd.</span></span><span class="sig-name descname"><span class="pre">device</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">daemon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tomato.html#tomato.models.Daemon" title="tomato.models.Daemon"><span class="pre">Daemon</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="tomato.html#tomato.models.Reply" title="tomato.models.Reply"><span class="pre">Reply</span></a></span></span><a class="headerlink" href="#tomato.daemon.cmd.device" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.cmd.component">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.cmd.</span></span><span class="sig-name descname"><span class="pre">component</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">daemon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tomato.html#tomato.models.Daemon" title="tomato.models.Daemon"><span class="pre">Daemon</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="tomato.html#tomato.models.Reply" title="tomato.models.Reply"><span class="pre">Reply</span></a></span></span><a class="headerlink" href="#tomato.daemon.cmd.component" title="Link to this definition"></a></dt>
<dd></dd></dl>

<section id="tomato-daemon-driver-the-driver-manager-of-tomato-daemon">
<span id="module-tomato.daemon.driver"></span><h3><strong>tomato.daemon.driver</strong>: the driver manager of tomato daemon<a class="headerlink" href="#tomato-daemon-driver-the-driver-manager-of-tomato-daemon" title="Link to this heading"></a></h3>
<p><em>Code author: Peter Kraus</em></p>
</section>
<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.driver.tomato_driver_bootstrap">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.driver.</span></span><span class="sig-name descname"><span class="pre">tomato_driver_bootstrap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">req</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Socket</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interface</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ModelInterface</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">driver</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tomato.daemon.driver.tomato_driver_bootstrap" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.driver.perform_idle_measurements">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.driver.</span></span><span class="sig-name descname"><span class="pre">perform_idle_measurements</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">interface</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ModelInterface</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_last</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#tomato.daemon.driver.perform_idle_measurements" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.driver.tomato_driver">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.driver.</span></span><span class="sig-name descname"><span class="pre">tomato_driver</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#tomato.daemon.driver.tomato_driver" title="Link to this definition"></a></dt>
<dd><p>The function called when <cite>tomato-driver</cite> is executed.</p>
<p>This function is responsible for managing all activities involving devices of a
single driver type.</p>
<p>First, the list of devices (and their channel/address) for the specified driver is
fetched from the <cite>tomato-daemon</cite>. Then, a new instance of the specified driver is
spawned, populating its device map using the above list. If successful, the current
process information is fed back to the <cite>tomato-daemon</cite>.</p>
<p>Afterwards, the main loop handles all requests related to each of the devices
managed by this driver process, including job commands. Finally, if the driver is
instructed to stop, it attempts to perform a teardown before exiting.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.driver.spawn_tomato_driver">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.driver.</span></span><span class="sig-name descname"><span class="pre">spawn_tomato_driver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">port</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">driver</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">req</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Socket</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbosity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logpath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tomato.daemon.driver.spawn_tomato_driver" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.driver.stop_tomato_driver">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.driver.</span></span><span class="sig-name descname"><span class="pre">stop_tomato_driver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">port</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tomato.daemon.driver.stop_tomato_driver" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.driver.manager">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.driver.</span></span><span class="sig-name descname"><span class="pre">manager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">port</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1000</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tomato.daemon.driver.manager" title="Link to this definition"></a></dt>
<dd><p>The driver manager thread of <cite>tomato-daemon</cite>.</p>
<p>This manager ensures individual driver processes are (re-)spawned and instructed to
quit as necessary.</p>
</dd></dl>

<section id="tomato-daemon-io-functions-for-storing-and-loading-data">
<span id="module-tomato.daemon.io"></span><h3><strong>tomato.daemon.io</strong>: functions for storing and loading data<a class="headerlink" href="#tomato-daemon-io-functions-for-storing-and-loading-data" title="Link to this heading"></a></h3>
<p><em>Code author: Peter Kraus</em></p>
</section>
<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.io.store">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.io.</span></span><span class="sig-name descname"><span class="pre">store</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daemon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tomato.html#tomato.models.Daemon" title="tomato.models.Daemon"><span class="pre">Daemon</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tomato.daemon.io.store" title="Link to this definition"></a></dt>
<dd><p>Stores the status of the provided <code class="xref py py-class docutils literal notranslate"><span class="pre">Daemon</span></code> as a <code class="docutils literal notranslate"><span class="pre">pickle</span></code> file.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.io.load">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.io.</span></span><span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daemon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tomato.html#tomato.models.Daemon" title="tomato.models.Daemon"><span class="pre">Daemon</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tomato.daemon.io.load" title="Link to this definition"></a></dt>
<dd><p>Restores a saved status from a <code class="docutils literal notranslate"><span class="pre">pickle</span></code> file into the provided <code class="xref py py-class docutils literal notranslate"><span class="pre">Daemon</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.io.merge_netcdfs">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.io.</span></span><span class="sig-name descname"><span class="pre">merge_netcdfs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">job</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tomato.html#tomato.models.Job" title="tomato.models.Job"><span class="pre">Job</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">snapshot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tomato.daemon.io.merge_netcdfs" title="Link to this definition"></a></dt>
<dd><p>Merges the individual pickled <code class="xref py py-class docutils literal notranslate"><span class="pre">xr.Datasets</span></code> of each Component found in <code class="xref py py-obj docutils literal notranslate"><span class="pre">job.jobpath</span></code>
into a single <code class="xref py py-class docutils literal notranslate"><span class="pre">xr.DataTree</span></code>, which is then stored in the NetCDF file,
using the Component <cite>role</cite> as the group label.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.io.data_to_pickle">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.io.</span></span><span class="sig-name descname"><span class="pre">data_to_pickle</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.xarray.dev/en/stable/generated/xarray.Dataset.html#xarray.Dataset" title="(in xarray v2025.4.1.dev0)"><span class="pre">Dataset</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">role</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tomato.daemon.io.data_to_pickle" title="Link to this definition"></a></dt>
<dd><p>Dumps the data provided as <code class="xref py py-class docutils literal notranslate"><span class="pre">xr.Dataset</span></code> into a <code class="docutils literal notranslate"><span class="pre">pickle</span></code>. Concatenates with
any existing data stored in the <code class="docutils literal notranslate"><span class="pre">pickle</span></code>.</p>
</dd></dl>

<section id="tomato-daemon-job-the-job-manager-of-tomato-daemon">
<span id="module-tomato.daemon.job"></span><h3><strong>tomato.daemon.job</strong>: the job manager of tomato daemon<a class="headerlink" href="#tomato-daemon-job-the-job-manager-of-tomato-daemon" title="Link to this heading"></a></h3>
<p><em>Code author: Peter Kraus</em></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Functions in this module that receive the <a class="reference internal" href="tomato.html#tomato.models.Daemon" title="tomato.models.Daemon"><code class="xref py py-class docutils literal notranslate"><span class="pre">Daemon</span></code></a> state
object should be acting on a copy. All changes to the <code class="xref py py-class docutils literal notranslate"><span class="pre">Daemon</span></code> state have to
be propagated via the <a class="reference internal" href="#module-tomato.daemon.cmd" title="tomato.daemon.cmd"><code class="xref py py-class docutils literal notranslate"><span class="pre">tomato.daemon.cmd</span></code></a> set of functions.</p>
</div>
</section>
<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.job.method_validate">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.job.</span></span><span class="sig-name descname"><span class="pre">method_validate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../quickstart.html#dgbowl_schemas.tomato.payload.Task" title="dgbowl_schemas.tomato.payload_2_1.task.Task"><span class="pre">Task</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pip</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tomato.html#tomato.models.Pipeline" title="tomato.models.Pipeline"><span class="pre">Pipeline</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">drvs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="tomato.html#tomato.models.Driver" title="tomato.models.Driver"><span class="pre">Driver</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="tomato.html#tomato.models.Component" title="tomato.models.Component"><span class="pre">Component</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Context</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tomato.daemon.job.method_validate" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.job.find_matching_pipelines">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.job.</span></span><span class="sig-name descname"><span class="pre">find_matching_pipelines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pips</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="tomato.html#tomato.models.Pipeline" title="tomato.models.Pipeline"><span class="pre">Pipeline</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="tomato.html#tomato.models.Component" title="tomato.models.Component"><span class="pre">Component</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">drvs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="tomato.html#tomato.models.Driver" title="tomato.models.Driver"><span class="pre">Driver</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../quickstart.html#dgbowl_schemas.tomato.payload.Task" title="dgbowl_schemas.tomato.payload_2_1.task.Task"><span class="pre">Task</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Context</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="tomato.html#tomato.models.Pipeline" title="tomato.models.Pipeline"><span class="pre">Pipeline</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#tomato.daemon.job.find_matching_pipelines" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.job.kill_tomato_job">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.job.</span></span><span class="sig-name descname"><span class="pre">kill_tomato_job</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">process</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Process</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tomato.daemon.job.kill_tomato_job" title="Link to this definition"></a></dt>
<dd><p>Wrapper around <code class="xref py py-func docutils literal notranslate"><span class="pre">psutil.terminate()</span></code>.</p>
<p>Here we kill the (grand)children of the process with the name of <cite>tomato-job</cite>,
i.e. the individual task functions. This allows the <cite>tomato-job</cite> process to exit
gracefully once the task functions join.</p>
<p>Note that on Windows, the <cite>tomato-job.exe</cite> process has two children: a <cite>python.exe</cite>
which is the actual process running the job, and <cite>conhost.exe</cite>, which we want to
avoid killing.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.job.manage_running_pips">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.job.</span></span><span class="sig-name descname"><span class="pre">manage_running_pips</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pips</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dbpath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">req</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tomato.daemon.job.manage_running_pips" title="Link to this definition"></a></dt>
<dd><p>Function that manages jobs and <cite>tomato-daemon</cite> pipelines.</p>
<p>The function only affects pipelines marked as running, i.e. with a set <code class="docutils literal notranslate"><span class="pre">jobid</span></code>.
Jobs scheduled for killing (i.e. <code class="docutils literal notranslate"><span class="pre">status</span> <span class="pre">==</span> <span class="pre">&quot;rd&quot;</span></code>) are terminated. Jobs that
are supposed to be running but have crashed are given appropriate status (<code class="docutils literal notranslate"><span class="pre">&quot;ce&quot;</span></code>).
Pipelines of both are reset.</p>
<p>Successful job completions are not processed here, but within the job process.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.job.check_queued_jobs">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.job.</span></span><span class="sig-name descname"><span class="pre">check_queued_jobs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pips</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">drvs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dbpath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Context</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="tomato.html#tomato.models.Pipeline" title="tomato.models.Pipeline"><span class="pre">Pipeline</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#tomato.daemon.job.check_queued_jobs" title="Link to this definition"></a></dt>
<dd><p>Function to check whether the queued jobs can be submitted onto any pipeline.</p>
<p>Returns a <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code> containing the jobids as keys and lists of matched
<code class="xref py py-class docutils literal notranslate"><span class="pre">Pipelines</span></code> as values.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.job.action_queued_jobs">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.job.</span></span><span class="sig-name descname"><span class="pre">action_queued_jobs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daemon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">matched</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">req</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tomato.daemon.job.action_queued_jobs" title="Link to this definition"></a></dt>
<dd><p>Function that assigns jobs if a matched pipeline contains the requested sample.</p>
<p>The <cite>tomato-job</cite> process is launched from this function.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.job.manager">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.job.</span></span><span class="sig-name descname"><span class="pre">manager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">port</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">500</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tomato.daemon.job.manager" title="Link to this definition"></a></dt>
<dd><p>The job manager thread of <cite>tomato-daemon</cite>.</p>
<p>This manager ensures the job queue is iterated over and pipelines are managed/reset.
Note that we poll the <cite>tomato-daemon</cite> for status only once per iteration of the main
loop.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.job.tomato_job">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.job.</span></span><span class="sig-name descname"><span class="pre">tomato_job</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#tomato.daemon.job.tomato_job" title="Link to this definition"></a></dt>
<dd><p>The function called when <cite>tomato-job</cite> is executed.</p>
<p>This function is resposible for managing all activities of a single job, including
contacting the daemon about job pid, spawning of sub-processes to run tasks on each
Component of the Pipeline, merging data at the end of the job, and reporting back
to the daemon once the job is successfully finished.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.job.job_thread">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.job.</span></span><span class="sig-name descname"><span class="pre">job_thread</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tasks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">component</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tomato.html#tomato.models.Component" title="tomato.models.Component"><span class="pre">Component</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tomato.html#tomato.models.Device" title="tomato.models.Device"><span class="pre">Device</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">driver</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tomato.html#tomato.models.Driver" title="tomato.models.Driver"><span class="pre">Driver</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">jobpath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logpath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tomato.daemon.job.job_thread" title="Link to this definition"></a></dt>
<dd><p>A subthread of <cite>tomato-job</cite>, responsible for tasks on one Component of a Pipeline.</p>
<p>For each task in tasks, starts the task, then monitors the Component status and polls
for data, and moves on to the next task as instructed in the payload.</p>
<p>Stores the data for that Component as a <cite>pickle</cite> of a <code class="xref py py-class docutils literal notranslate"><span class="pre">xr.Dataset</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.job.job_main_loop">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.job.</span></span><span class="sig-name descname"><span class="pre">job_main_loop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Context</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">port</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">job</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tomato.html#tomato.models.Job" title="tomato.models.Job"><span class="pre">Job</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">pipname</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logpath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#tomato.daemon.job.job_main_loop" title="Link to this definition"></a></dt>
<dd><p>The main loop function of <cite>tomato-job</cite>, split for better readability.</p>
</dd></dl>

<section id="tomato-daemon-jobdb-the-sqlite-database-for-jobs-in-tomato">
<span id="module-tomato.daemon.jobdb"></span><h3><strong>tomato.daemon.jobdb</strong>: the sqlite database for jobs in tomato<a class="headerlink" href="#tomato-daemon-jobdb-the-sqlite-database-for-jobs-in-tomato" title="Link to this heading"></a></h3>
<p><em>Code author: Peter Kraus</em></p>
</section>
<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.jobdb.connect_jobdb">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.jobdb.</span></span><span class="sig-name descname"><span class="pre">connect_jobdb</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dbpath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#tomato.daemon.jobdb.connect_jobdb" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.jobdb.jobdb_setup">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.jobdb.</span></span><span class="sig-name descname"><span class="pre">jobdb_setup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dbpath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#tomato.daemon.jobdb.jobdb_setup" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.jobdb.insert_job">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.jobdb.</span></span><span class="sig-name descname"><span class="pre">insert_job</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">job</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tomato.html#tomato.models.Job" title="tomato.models.Job"><span class="pre">Job</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">dbpath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">int</span></span></span><a class="headerlink" href="#tomato.daemon.jobdb.insert_job" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.jobdb.update_job_id">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.jobdb.</span></span><span class="sig-name descname"><span class="pre">update_job_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dbpath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="tomato.html#tomato.models.Job" title="tomato.models.Job"><span class="pre">Job</span></a></span></span><a class="headerlink" href="#tomato.daemon.jobdb.update_job_id" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.jobdb.get_job_id">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.jobdb.</span></span><span class="sig-name descname"><span class="pre">get_job_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dbpath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="tomato.html#tomato.models.Job" title="tomato.models.Job"><span class="pre">Job</span></a></span></span><a class="headerlink" href="#tomato.daemon.jobdb.get_job_id" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tomato.daemon.jobdb.get_jobs_where">
<span class="sig-prename descclassname"><span class="pre">tomato.daemon.jobdb.</span></span><span class="sig-name descname"><span class="pre">get_jobs_where</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">where</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dbpath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="tomato.html#tomato.models.Job" title="tomato.models.Job"><span class="pre">Job</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#tomato.daemon.jobdb.get_jobs_where" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tomato.html" class="btn btn-neutral float-left" title="tomato package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tomato.driverinterface_1_0.html" class="btn btn-neutral float-right" title="tomato.driverinterface_1_0 package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021 - 2024, dgbowl authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Other Versions</span>
      v: 2.1rc2.post1
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions"> 
      <script src="../versions.js"></script>
    </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>